# Development & CI Lessons

## 1. ログ出力の重要性 (2026-02-02)

* **事象**: スクリプトがエラーなく終了しているのに何も出力されないケースがあった。
* **教訓**:
  * 標準出力(`print`)はバッファリングされることがあるため、`sys.stdout.flush()` するか `python -u` オプションを使用する。
  * 重要な分岐には必ずログを入れる。

## 2. CI(GitHub Actions) の Lint エラー対応 (2026-02-03)

* **事象**: インデントミス、unused global、未定義変数などでCIが失敗した。
* **教訓**:
  * ファイル分割・新規作成時は単独実行や `flake8` チェックを行う。
  * 不要な `global` は削除する。
  * 条件付きインポート時は、失敗時の変数定義（`None`初期化など）を漏らさない。

## 3. フロントエンド検証スクリプトの実行環境 (2026-02-07)

* **事象**: `validate_frontend.py` はヘッドレスブラウザを使用するため、Flaskサーバーが起動している必要がある。
* **教訓**: フロントエンド検証時は、`python app.py` をバックグラウンドで起動してから検証スクリプトを走らせる手順をルーチン化すべき。

## 4. Flake8対応と辞書キー名の罠 (2026-02-14)

* **事象**: コピペ実装により未使用インポートやキー名の誤認（`amount` vs `total_amount`）が発生した。
* **対策**:
  * 新規スクリプト作成時は実行前に `flake8` をかける。
  * 共有モジュール（`BettingAllocator`等）の戻り値仕様をソースレベルで確認する。
