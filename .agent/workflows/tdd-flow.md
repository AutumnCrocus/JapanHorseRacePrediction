---
description: tdd-flow
---

steps:
      - "1. [Requirement Definition] 実装する機能を「どのような入力に対して、どのような結果（計算結果やDB更新）が返るべきか」という形式で明確に定義する"
      - "2. [Test Case Planning] コードを書く前に、以下の観点でテストケース一覧を作成する: (A)正常系（期待通りの予測・計算） (B)異常系（スクレイピング失敗、データ欠損） (C)境界値（予算0円、該当レースなし）。これによりロジックの堅牢性を担保する"
      - "3. [Test First (Red Phase)] 確定したテストケースに基づき、`tests/` フォルダに `pytest` 用のテストコードを作成する。まずは実装がない、または不十分なためテストが失敗すること（Red状態）を確認する"
      - "4. [Implementation (Green Phase)] テストをパスさせるためだけの「最小限の実装」を行い、素早く機能を実現する"
      - "5. [Self-Healing Cycle] テストが失敗した場合、ユーザーに助言を求めず、以下のループを自律的に実行する: (1) エラーログ（Traceback）を分析 (2) 原因（ロジックミス、型不一致）を特定 (3) 実装コードを修正 (4) テスト再実行。これをGreenになるまで繰り返す"
      - "6. [Refactoring] テストが通る状態（Green）を維持したまま、コードの整理、重複排除、可読性向上を行う"
      - "7. [Regresion Check] ローカルで全テスト (`pytest`) を実行し、既存機能（予測精度や他のロジック）に悪影響が出ていないことを最終確認する"